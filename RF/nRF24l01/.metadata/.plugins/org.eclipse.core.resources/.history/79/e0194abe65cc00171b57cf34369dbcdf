/*
 * PR_nRF.c
 *
 *  Created on: 14 de nov. de 2017
 *      Author: fedec
 */
#include "Aplicacion.h"

volatile uint8_t nRF_Status_Reg;

void RWnRF (uint8_t cmd, uint8_t reg, uint8_t *package, uint8_t size)
{
	uint8_t i;
	if (cmd == W) //Si se quiere escribir algún registro, necesito adherir la instrucción Write: 001AAAAA
		reg = W_REGISTER+reg;	//En cambio la de lectura es 0x000AAAAA, así que no tengo que adherir nada

	SetPIN(pin_CSN,0); //Notifico que comienza secuencia de transmisión
	//Siempre que mando el comando obtengo el Status Register
	nRF_Status_Reg=SendReceiveSSP(reg);
	//Tal vez hagan falta demoras
	for (i=0; i<size;i++)
	{
		if (cmd==R && reg!=W_TX_PAYLOAD)
		{
			//Falta ver lo de TX_PAYLOAD
			//Como voy a recibir no me importa lo que mando
			*(package+i)=SendReceiveSSP(NOP);
			//delay?

		}
		else
		{
			//Lo que envío lo leo del paquete y no me preocupo por lo que recibo (basura)
			SendReceiveSSP(*(package+i));//dont care about return value
			//delay?
		}

	}
	SetPIN(pin_CSN, 1); //vuelve a estado iddle

}
